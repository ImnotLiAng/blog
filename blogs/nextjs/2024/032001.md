---
title: next.js
date: 2022/05/27
tags:
 - framework
categories:
 - nextjs
---

next 跟纯 React 应用相比，通过特定的结构提供高级的功能。

### 提供的功能
- ssr
- 文件系统路由
- 自动代码分割（不需要提前知道有哪些路由；路由总是可以懒加载的）
- 数据预获取（顶层组件能够定义 getInitialProps 来阻塞路由加载（服务端渲染和懒加载））
- 静态文件服务（public目录下的文件通过 URL 直接访问）
- CSS 模块化
- 快速刷新
- 支持 TypeScript
- 优化构建和部署
    - 自动优化图片
    - 压缩代码
    - 支持静态导出

### 特点

因此，所有顶层组件可以在接受 `url对象` 时，可以对 url 进行检查和对历史记录进行修改

<link /> 组件包裹 a 标签在客户端进行组件转换

### 使用 css-in-js 的好处
- 支持解析-不需要单独的css预处理器
- 自动添加前缀
- 模块化
- 支持热重载
- 动态添加和移除样式--在通过 `pushState` 进行动态加载组件时，每次加载新组件都会在文档头部插入新的`<style>`，不必要的`<style>`元素会增加页面的渲染时间和内存消耗，使得页面加载速度变慢。
- 准确性-由于样式通过 js 对象定义，因此更容易使用辅助功能如格式化、类型检查、自动补全等，虽然纯 css 也能处理，但是这样就不需要添加额外的库和工具。


### 代码分割
默认根据路由自动进行代码分割和处理公共组件，**将公共组件打包到所有引用到它的页面代码块中**： 可以使用 webpack 的 SplitChunksPlugin 来优化公共组件的打包方式，将它们提取出来，打包成单独的文件，减少请求次数。

### CSS 模块化
每个类名转换为一个唯一的标识符

### 架构

#### 快速刷新
编辑仅导出 React 组件的文件时，仅重渲染该组件，否则重运行该文件及导入该文件的文件； 如果编辑的是非 React 组件树的文件，则会进行全量更新，

捕获语法错误，可以修改该语法错误进行增量更新，

捕获运行错误，也可以修改该错误后进行增量更新，即使设置了 ErrorBoundary

默认保留 React 组件当前状态，如果需要重置，可以在文件中添加 `// @refresh reset`

刷新期间，useEffect，useMemo，useCallback 会重新运行，尽管它们的依赖没有被改变

#### 编译器
next.js 使用 SWC 代替 babel 和 Teser 编译和压缩文件，但如果项目中存在 babel 配置文件，仍继续使用 babel 编译

#### 打包器
在开发环境中，next.js 正在使用 Turbopack (同样是 vercel 开发)代替 webpack